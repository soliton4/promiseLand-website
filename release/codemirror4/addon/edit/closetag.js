//>>built
(function(c){"object"==typeof exports&&"object"==typeof module?c(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define("codemirror4/addon/edit/closetag",["../../lib/codemirror","../fold/xml-fold"],c):c(CodeMirror)})(function(c){function q(b){if(b.getOption("disableInput"))return c.Pass;for(var h=b.listSelections(),e=[],a=0;a<h.length;a++){if(!h[a].empty())return c.Pass;var g=h[a].head,d=b.getTokenAt(g),l=c.innerMode(b.getMode(),d.state),n=l.state;
if("xml"!=l.mode.name||!n.tagName)return c.Pass;var f=b.getOption("autoCloseTags"),k="html"==l.mode.configuration,l="object"==typeof f&&f.dontCloseTags||k&&r,k="object"==typeof f&&f.indentTags||k&&s,f=n.tagName;d.end>g.ch&&(f=f.slice(0,f.length-d.end+g.ch));var m=f.toLowerCase();if(!f||"string"==d.type&&(d.end!=g.ch||!/[\"\']/.test(d.string.charAt(d.string.length-1))||1==d.string.length)||"tag"==d.type&&"closeTag"==n.type||d.string.indexOf("/")==d.string.length-1||l&&-1<p(l,m)||c.scanForClosingTag&&
c.scanForClosingTag(b,g,f,Math.min(b.lastLine()+1,g.line+50)))return c.Pass;d=k&&-1<p(k,m);e[a]={indent:d,text:"\x3e"+(d?"\n\n":"")+"\x3c/"+f+"\x3e",newPos:d?c.Pos(g.line+1,0):c.Pos(g.line,g.ch+1)}}for(a=h.length-1;0<=a;a--)g=e[a],b.replaceRange(g.text,h[a].head,h[a].anchor,"+insert"),d=b.listSelections().slice(0),d[a]={head:g.newPos,anchor:g.newPos},b.setSelections(d),g.indent&&(b.indentLine(g.newPos.line,null,!0),b.indentLine(g.newPos.line+1,null,!0))}function p(b,c){if(b.indexOf)return b.indexOf(c);
for(var e=0,a=b.length;e<a;++e)if(b[e]==c)return e;return-1}c.defineOption("autoCloseTags",!1,function(b,h,e){e!=c.Init&&e&&b.removeKeyMap("autoCloseTags");if(h){e={name:"autoCloseTags"};if("object"!=typeof h||h.whenClosing)e["'/'"]=function(a){a:if(a.getOption("disableInput"))a=c.Pass;else{for(var b=a.listSelections(),d=[],e=0;e<b.length;e++){if(!b[e].empty()){a=c.Pass;break a}var h=b[e].head,f=a.getTokenAt(h),k=c.innerMode(a.getMode(),f.state),m=k.state;if("string"==f.type||"\x3c"!=f.string.charAt(0)||
f.start!=h.ch-1||"xml"!=k.mode.name||!m.context||!m.context.tagName){a=c.Pass;break a}d[e]="/"+m.context.tagName+"\x3e"}a.replaceSelections(d);a=void 0}return a};if("object"!=typeof h||h.whenOpening)e["'\x3e'"]=function(a){return q(a)};b.addKeyMap(e)}});var r="area base br col command embed hr img input keygen link meta param source track wbr".split(" "),s="applet blockquote body button div dl fieldset form frameset h1 h2 h3 h4 h5 h6 head html iframe layer legend object ol p select table ul".split(" ")});
//# sourceMappingURL=closetag.js.map