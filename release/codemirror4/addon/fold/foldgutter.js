//>>built
(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define("codemirror4/addon/fold/foldgutter",["../../lib/codemirror","./foldcode"],h):h(CodeMirror)})(function(h){function s(a){this.options=a;this.from=this.to=0}function n(a){if("string"==typeof a){var b=document.createElement("div");b.className=a;return b}return a.cloneNode(!0)}function f(a,b,c){var d=a.state.foldGutter.options,g=b;a.eachLine(b,
c,function(b){var c=null,e;a:{e=g;for(var k=a.findMarksAt(m(e)),f=0;f<k.length;++f)if(k[f].__isFold&&k[f].find().from.line==e){e=!0;break a}e=void 0}e?c=n(d.indicatorFolded):(e=m(g,0),(e=(k=d.rangeFinder||h.fold.auto)&&k(a,e))&&e.from.line+1<e.to.line&&(c=n(d.indicatorOpen)));a.setGutterMarker(b,d.gutter,c);++g})}function g(a){var b=a.getViewport(),c=a.state.foldGutter;c&&(a.operation(function(){f(a,b.from,b.to)}),c.from=b.from,c.to=b.to)}function p(a,b,c){var d=a.state.foldGutter.options;c==d.gutter&&
a.foldCode(m(b,0),d.rangeFinder)}function q(a){var b=a.state.foldGutter,c=a.state.foldGutter.options;b.from=b.to=0;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){g(a)},c.foldOnChangeTimeSpan||600)}function r(a){var b=a.state.foldGutter,c=a.state.foldGutter.options;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){var c=a.getViewport();b.from==b.to||20<c.from-b.to||20<b.from-c.to?g(a):a.operation(function(){c.from<b.from&&(f(a,c.from,b.from),b.from=c.from);c.to>b.to&&
(f(a,b.to,c.to),b.to=c.to)})},c.updateViewportTimeSpan||400)}function l(a,b){var c=a.state.foldGutter,d=b.line;d>=c.from&&d<c.to&&f(a,d,d+1)}h.defineOption("foldGutter",!1,function(a,b,c){c&&c!=h.Init&&(a.clearGutter(a.state.foldGutter.options.gutter),a.state.foldGutter=null,a.off("gutterClick",p),a.off("change",q),a.off("viewportChange",r),a.off("fold",l),a.off("unfold",l),a.off("swapDoc",g));b&&(c=a.state,!0===b&&(b={}),null==b.gutter&&(b.gutter="CodeMirror-foldgutter"),null==b.indicatorOpen&&(b.indicatorOpen=
"CodeMirror-foldgutter-open"),null==b.indicatorFolded&&(b.indicatorFolded="CodeMirror-foldgutter-folded"),c.foldGutter=new s(b),g(a),a.on("gutterClick",p),a.on("change",q),a.on("viewportChange",r),a.on("fold",l),a.on("unfold",l),a.on("swapDoc",g))});var m=h.Pos});
//# sourceMappingURL=foldgutter.js.map