//>>built
(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define("codemirror4/addon/search/search",["../../lib/codemirror","./searchcursor","../dialog/dialog"],e):e(CodeMirror)})(function(e){function s(a,c){"string"==typeof a?a=RegExp(a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),c?"gi":"g"):a.global||(a=RegExp(a.source,a.ignoreCase?"gi":"g"));return{token:function(b){a.lastIndex=
b.pos;var d=a.exec(b.string);if(d&&d.index==b.pos)return b.pos+=d[0].length,"searching";d?b.pos=d.index:b.skipToEnd()}}}function t(){this.overlay=this.posFrom=this.posTo=this.query=null}function g(a){return a.state.search||(a.state.search=new t)}function k(a){return"string"==typeof a&&a==a.toLowerCase()}function h(a,c,b){return a.getSearchCursor(c,b,k(c))}function l(a,c,b,d,f){a.openDialog?a.openDialog(c,f,{value:d}):f(prompt(b,d))}function u(a,c,b,d){if(a.openConfirm)a.openConfirm(c,d);else if(confirm(b))d[0]()}
function p(a){var c=a.match(/^\/(.*)\/([a-z]*)$/);c?(a=RegExp(c[1],-1==c[2].indexOf("i")?"":"i"),a.test("")&&(a=/x^/)):""==a&&(a=/x^/);return a}function m(a,c){var b=g(a);if(b.query)return q(a,c);l(a,v,"Search for:",a.getSelection(),function(d){a.operation(function(){d&&!b.query&&(b.query=p(d),a.removeOverlay(b.overlay,k(b.query)),b.overlay=s(b.query,k(b.query)),a.addOverlay(b.overlay),b.posFrom=b.posTo=a.getCursor(),q(a,c))})})}function q(a,c){a.operation(function(){var b=g(a),d=h(a,b.query,c?b.posFrom:
b.posTo);if(!d.find(c)&&(d=h(a,b.query,c?e.Pos(a.lastLine()):e.Pos(a.firstLine(),0)),!d.find(c)))return;a.setSelection(d.from(),d.to());a.scrollIntoView({from:d.from(),to:d.to()});b.posFrom=d.from();b.posTo=d.to()})}function n(a){a.operation(function(){var c=g(a);c.query&&(c.query=null,a.removeOverlay(c.overlay))})}function r(a,c){l(a,w,"Replace:",a.getSelection(),function(b){b&&(b=p(b),l(a,x,"Replace with:","",function(d){if(c)a.operation(function(){for(var c=h(a,b);c.findNext();)if("string"!=typeof b){var e=
a.getRange(c.from(),c.to()).match(b);c.replace(d.replace(/\$(\d)/g,function(a,b){return e[b]}))}else c.replace(d)});else{n(a);var f=h(a,b,a.getCursor()),e=function(){var c=f.from(),d;if(!(d=f.findNext()))if(f=h(a,b),!(d=f.findNext())||c&&f.from().line==c.line&&f.from().ch==c.ch)return;a.setSelection(f.from(),f.to());a.scrollIntoView({from:f.from(),to:f.to()});u(a,y,"Replace?",[function(){g(d)},e])},g=function(a){f.replace("string"==typeof b?d:d.replace(/\$(\d)/g,function(b,c){return a[c]}));e()};
e()}}))})}var v='Search: \x3cinput type\x3d"text" style\x3d"width: 10em"/\x3e \x3cspan style\x3d"color: #888"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',w='Replace: \x3cinput type\x3d"text" style\x3d"width: 10em"/\x3e \x3cspan style\x3d"color: #888"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',x='With: \x3cinput type\x3d"text" style\x3d"width: 10em"/\x3e',y="Replace? \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e";e.commands.find=
function(a){n(a);m(a)};e.commands.findNext=m;e.commands.findPrev=function(a){m(a,!0)};e.commands.clearSearch=n;e.commands.replace=r;e.commands.replaceAll=function(a){r(a,!0)}});
//# sourceMappingURL=search.js.map